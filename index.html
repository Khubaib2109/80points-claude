<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>80 Points Online</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      color: #333;
      margin-bottom: 24px;
      font-size: 32px;
    }

    .status {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-weight: 600;
    }

    .status.connected {
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }

    .status.disconnected {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }

    .message {
      color: #666;
      margin-bottom: 16px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
    }

    .info {
      color: #888;
      font-size: 14px;
      line-height: 1.6;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 8px;
      margin-top: 16px;
      transition: background 0.3s;
    }

    button:hover {
      background: #5568d3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .room-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 2px solid #e9ecef;
    }

    input {
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      width: 200px;
      margin-right: 8px;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }

    .room-info {
      margin-top: 16px;
      padding: 12px;
      background: #e7f3ff;
      border-radius: 6px;
      color: #004085;
    }

    .error {
      color: #d32f2f;
      background: #ffebee;
      padding: 12px;
      border-radius: 6px;
      margin-top: 16px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üÉè 80 Points Online</h1>
    
    <div id="status" class="status disconnected">
      <div>Status: <strong>NOT CONNECTED</strong></div>
    </div>

    <div id="message" class="message">
      Loading Socket.IO library...
    </div>

    <div class="info">
      Server: https://eight0-points-online.onrender.com
    </div>

    <div class="room-section" id="roomSection" style="display: none;">
      <h2 style="margin-bottom: 16px; color: #555;">Room Management</h2>
      
      <div>
        <button id="createRoomBtn">Create New Room</button>
      </div>

      <div style="margin-top: 16px;">
        <input type="text" id="roomCodeInput" placeholder="Enter room code" maxlength="6">
        <button id="joinRoomBtn">Join Room</button>
      </div>

      <div id="roomInfo" class="room-info" style="display: none;">
        <strong>Current Room:</strong> <span id="currentRoom"></span>
      </div>
    </div>

    <div id="errorDiv" class="error" style="display: none;"></div>
  </div>

  <!-- Socket.IO Client Library from CDN -->
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" 
          integrity="sha384-7bLcbQdJvCxIjfLdPLLF4bPMmQqGdPzZvSZzFjL1tqYHdMfZf5VZcEZyMPkPKEHB" 
          crossorigin="anonymous"
          onerror="handleScriptError()"></script>
  
  <script>
    function handleScriptError() {
      const messageDiv = document.getElementById('message');
      const errorDiv = document.getElementById('errorDiv');
      messageDiv.textContent = 'Failed to load Socket.IO library from CDN';
      errorDiv.style.display = 'block';
      errorDiv.innerHTML = 'Could not load Socket.IO. Please check your internet connection or try using a different network.';
    }

    // Wait for Socket.IO to load
    window.addEventListener('load', function() {
      const messageDiv = document.getElementById('message');
      const errorDiv = document.getElementById('errorDiv');
      
      // Check if io is defined
      if (typeof io === 'undefined') {
        messageDiv.textContent = 'Socket.IO library failed to load';
        errorDiv.style.display = 'block';
        errorDiv.innerHTML = 'Socket.IO CDN appears to be blocked or unavailable. Try:<br>1. Checking your internet connection<br>2. Disabling ad blockers<br>3. Using a different network';
        return;
      }

      messageDiv.textContent = 'Connecting to server...';

      // Connect to your Render server
      const socket = io("https://eight0-points-online.onrender.com", {
        transports: ["websocket", "polling"],
        reconnection: true,
        reconnectionDelay: 1000,
        reconnectionAttempts: 5
      });

      // DOM elements
      const statusDiv = document.getElementById('status');
      const roomSection = document.getElementById('roomSection');
      const createRoomBtn = document.getElementById('createRoomBtn');
      const joinRoomBtn = document.getElementById('joinRoomBtn');
      const roomCodeInput = document.getElementById('roomCodeInput');
      const roomInfo = document.getElementById('roomInfo');
      const currentRoom = document.getElementById('currentRoom');

      let myRoomCode = null;

      // Connection handlers
      socket.on('connect', () => {
        console.log('Connected to server!');
        statusDiv.className = 'status connected';
        statusDiv.innerHTML = '<div>Status: <strong>CONNECTED ‚úÖ</strong></div>';
        messageDiv.textContent = 'Successfully connected to the game server!';
        roomSection.style.display = 'block';
        errorDiv.style.display = 'none';
      });

      socket.on('disconnect', () => {
        console.log('Disconnected from server');
        statusDiv.className = 'status disconnected';
        statusDiv.innerHTML = '<div>Status: <strong>DISCONNECTED ‚ùå</strong></div>';
        messageDiv.textContent = 'Lost connection to server. Attempting to reconnect...';
        roomSection.style.display = 'none';
      });

      socket.on('connect_error', (error) => {
        console.error('Connection error:', error);
        messageDiv.textContent = 'Connection failed';
        errorDiv.style.display = 'block';
        errorDiv.innerHTML = `Cannot connect to server. Possible reasons:<br>
          1. Your Render server might be sleeping (free tier spins down after inactivity)<br>
          2. Server URL might be incorrect<br>
          3. CORS settings on server<br>
          <br>Visit your Render dashboard to check if the server is running.`;
      });

      // Room handlers
      socket.on('room_created', (data) => {
        console.log('Room created:', data);
        myRoomCode = data.code;
        currentRoom.textContent = data.code;
        roomInfo.style.display = 'block';
        messageDiv.textContent = `Room created! Code: ${data.code}`;
      });

      socket.on('joined_room', (data) => {
        console.log('Joined room:', data);
        myRoomCode = data.code;
        currentRoom.textContent = data.code;
        roomInfo.style.display = 'block';
        messageDiv.textContent = `Successfully joined room: ${data.code}`;
      });

      socket.on('room_state', (state) => {
        console.log('Room state update:', state);
      });

      socket.on('error_msg', (data) => {
        console.error('Server error:', data);
        messageDiv.textContent = `Error: ${data.message}`;
      });

      // Button handlers
      createRoomBtn.addEventListener('click', () => {
        console.log('Creating room...');
        socket.emit('create_room');
      });

      joinRoomBtn.addEventListener('click', () => {
        const code = roomCodeInput.value.trim().toUpperCase();
        if (code.length === 6) {
          console.log('Joining room:', code);
          socket.emit('join_room', { code });
          roomCodeInput.value = '';
        } else {
          messageDiv.textContent = 'Please enter a valid 6-character room code';
        }
      });

      // Allow Enter key to join room
      roomCodeInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          joinRoomBtn.click();
        }
      });

      console.log('80 Points client initialized');
    });
  </script>
</body>
</html>